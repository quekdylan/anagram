<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Anagram</title>
    <!--Bootstrap CSS, JavaScript/JQuery files -->
    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <!--Custom styles-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <style>
        .heading {
            font-family: 'Nunito', sans-serif;
            color: #666;
            text-decoration: none;
        }

        .letter {
            display: flex;
            background-color: #eee;
            border: #aaa 2px solid;
            border-radius: 10px;
            width: 25vw;
            height: 25vw;
            margin: 5px;
            max-height: 186px;
            font-family: 'Nunito', sans-serif;
            font-size: 10vw;
            justify-content: center;
            align-items: center;
            transition: background-color 0.2s ease-out;
            cursor: pointer;
        }

        .letter_clicked {
            background-color: #aaa !important;
            border: #444 4px solid;
        }

        .letter_correct {
            background-color: #52ff9a !important;
            border: #22824a 4px solid;
        }

        .letter_wrong {
            background-color: #ff5d52 !important;
            border: #822222 4px solid;
        }

        #l4 {
            background-color: #91c3ff;
            border: #406fa8 6px solid;
            color: #1d314a;
        }

        .button {
            border: none;
            text-decoration: none;
            display: inline-block;
            background-color: #ff5d52;
            border-radius: 10000px;
            width: 16vw;
            height: 16vw;
            max-width: 100px;
            max-height: 100px;
        }

        #clear_btn {
            background-color: #ff5d52;
            border: #a13830 4px solid;
            transition: background-color 0.1s ease-out;
        }


        #clear_btn:active {
            background-color: #a13830
        }

        #submit_btn {
            background-color: #49e98c;
            border: #39b16b 4px solid;
            transition: background-color 0.1s ease-out;
        }


        #submit_btn:active {
            background-color: #39b16b;
        }

        #textbox {
            border: none;
            text-align:center;
            font-size: 5vw;
            font-family: 'Nunito', sans-serif;
            width: 40vw;
            max-width: 600px;
            caret-color: transparent;
            transition: all 0.2s;
            text-transform: uppercase;
            cursor: default;
            outline: none;
        }

        .textbox_wrong {
            color: maroon;
        }

        .bi {
            max-width: 50px;
            max-height: 50px;
        }

        .letter_background {
            background-color: #ddd;
            border-radius: 4px;
            width: 25px;
            height: 30px;
            margin: 2px;
            font-family: 'Nunito', sans-serif;
            text-align: center;
            font-size: 18px;
            padding-top: 2px;
            color: #666;
        }

        .letter_row {
            display: flex;
            flex-flow: row nowrap;
            margin-bottom: 10px;
        }

        footer {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 1.6rem;
            font-size: 0.8rem;
        }

        #donation_collapse:hover {
            -webkit-box-shadow: inset 0px 25px 50px -40px rgba(0, 140, 255,0.6); 
            box-shadow: inset 0px 25px 50px -40px rgba(0, 140, 255,0.6);
            transition: 0.5s;
        }

        @media screen and (min-width: 860px) {
            .letter { 
                font-size: 84px;
            }
            #textbox {
                width: 250px;
                font-size: 32px;
            }

            #clear_btn:hover {
                background-color: #c4473e
            }

            
            #submit_btn:hover {
                background-color: #3ec777;
            }
        }
                
    </style>
</head>
<body>
    <header>
        <nav class="navbar navbar-light bg-light">
            <div class="container-fluid d-flex justify-content-center">
                <a class="heading" style="font-size: 2em; cursor: pointer;" data-bs-toggle="modal" data-bs-target="#anagramModal">anagram</a>
            </div>
        </nav>
    </header>

    <main>
        <div class="d-flex justify-content-center">
            <div style="max-width: 600px; margin-top: 10px;">
                <div class="d-flex flex-row justify-content-between">
                    <div></div>
                    <div>
                        <h1 id="score" class="heading" data-bs-toggle="offcanvas" data-bs-target="#offcanvasWithBackdrop" aria-controls="offcanvasWithBackdrop" style="cursor:pointer;">0</h1>
                    </div>
                    <div></div>
                </div>
                <div id="letter_box">
                    <div class="d-flex flex-row">
                        <div class="letter" id="l0"></div>
                        <div class="letter" id="l1"></div>
                        <div class="letter" id="l2"></div>
                    </div>
                    <div class="d-flex flex-row">
                        <div class="letter" id="l3"></div>
                        <div class="letter" id="l4"></div>
                        <div class="letter" id="l5"></div>
                    </div>
                    <div class="d-flex flex-row">
                        <div class="letter" id="l6"></div>
                        <div class="letter" id="l7"></div>
                        <div class="letter" id="l8"></div>
                    </div>
                </div>
                <div class="d-flex flex-row justify-content-between align-items-center mt-4 px-1">
                    <div>
                        <button class="button" id="clear_btn">                        
                            <svg xmlns="http://www.w3.org/2000/svg" width="6vw" height="6vw" fill="white" class="bi bi-x-lg" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M13.854 2.146a.5.5 0 0 1 0 .708l-11 11a.5.5 0 0 1-.708-.708l11-11a.5.5 0 0 1 .708 0Z"/>
                                <path fill-rule="evenodd" d="M2.146 2.146a.5.5 0 0 0 0 .708l11 11a.5.5 0 0 0 .708-.708l-11-11a.5.5 0 0 0-.708 0Z"/>
                            </svg>
                        </button>
                    </div>
                    <div>
                        <input type="text" id="textbox" onkeypress="return /[a-z]/i.test(event.key)" maxlength="9"/> 
                    </div>
                    <div>
                        <button class="button" id="submit_btn">                        
                            <svg xmlns="http://www.w3.org/2000/svg" width="6vw" height="6vw" fill="white" class="bi bi-check-lg" viewBox="0 0 16 16">
                                <path d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425a.247.247 0 0 1 .02-.022Z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!--word list-->
        <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasWithBackdrop" aria-labelledby="offcanvasWithBackdropLabel">
            <div class="offcanvas-header">
              <h4 class="offcanvas-title" id="offcanvasWithBackdropLabel">Word list</h4>
              <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <h5 id="puzzle_info"></h5>
            <div class="offcanvas-body" id="wordList">
              
            </div>
        </div>

        <!--anagram modal-->
        <div class="modal fade" id="anagramModal" tabindex="-1" aria-labelledby="anagramModalLabel" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-body">
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="float:right;"></button>
                  <h4 class="modal-title heading" id="anagramModalLabel">anagram</h4>
                  <p style="font-family: 'Nunito', sans-serif; font-size: 0.8em; color: #bbb;">PUZZLE #1 | 5/2/22</p>
                  <div class="justify-self-center">
                      <center>
                        <h6 class="heading" style="color: #aaa;">NEXT PUZZLE IN</h6>
                        <h4 class="heading" id="timer"></h4>
                      </center>
                  </div>
                </div>
                <div class="modal-footer justify-content-between py-2" data-bs-toggle="collapse" href="#collapseExample" role="button" aria-expanded="false" aria-controls="collapseExample" id="donation_collapse">
                    <div>
                        <p class="heading" style="margin-bottom: -10px;">Donate</p>
                        <span style="font-family: 'Nunito', sans-serif; font-size: 0.8em; color: #bbb;">anagram will always remain ad free</span>
                    </div>
                    <div>
                        <span><img src="media/bitcoin.png" width="25px"/></span>
                        <span><img src="media/ether.png" width="25px"/></span>
                    </div>
                </div>
                <div class="collapse" id="collapseExample">
                    <div class="card card-body d-flex justify-content-center">
                        <img src="media/eth_qr.png" width="100%" style="max-width: 250px;"/>
                    </div>
                </div>
              </div>
            </div>
          </div>

    </main>
</body>
<script>

    // cookie management
    function setCookie(cname, cvalue, exdays) {
        const d = new Date();
        d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
        let expires = "expires="+d.toUTCString();
        document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
        }

        function getCookie(cname) {
        let name = cname + "=";
        let ca = document.cookie.split(';');
        for(let i = 0; i < ca.length; i++) {
            let c = ca[i];
            while (c.charAt(0) == ' ') {
            c = c.substring(1);
            }
            if (c.indexOf(name) == 0) {
            return c.substring(name.length, c.length);
            }
        }
        return "";
    }


    var puzzle = "ENCDTONER";
    var answer = ['CONTENDER', 'CENTRED', 'CENTER', 'CENTRE', 'DECENT', 'RECENT', 'RENTED', 'RODENT', 'TENDER', 'TENDON', 'TENNER', 'ENTER', 'ERECT', 'NOTED', 'TENOR', 'TONED', 'TONER', 'TREND', 'CENT', 'DENT', 'DOTE', 'NOTE', 'RENT', 'TEED', 'TEEN', 'TEND', 'TOED', 'TONE', 'TORE', 'TORN', 'TREE', 'COT', 'DOT', 'NET', 'NOT', 'ORT', 'ROT', 'TED', 'TEE', 'TEN', 'TOD', 'TOE', 'TON', 'TOR']
    var guesses = [];

    for (i in answer) {
        id = "word" + i
        $("#wordList").append('<div id='+id+' class="letter_row"></div>');
        $("#"+id).append('<span style="color: #888; padding-top: 4px; width: 25px;">'+(parseInt(i)+1)+'</span>');
        for (x in answer[i]) {
            $("#"+id).append('<div class="letter_background"></div>');
        }
    }

    if (getCookie('guesses') != "") {
        guesses = (getCookie('guesses').split(","));
        $("#score").html(guesses.length);
        for(input in guesses) {
            word_id = "word" + answer.indexOf(guesses[input])
            children = document.getElementById(word_id).getElementsByTagName('*');
            for (i in guesses[input]){
                children[parseInt(i)+1].innerHTML = guesses[input][i];
            }
        }
    }

    // Initialization
    for (i in puzzle){
        char = puzzle[i];
        var id = "#l" + i.toString();
        $( id ).html(char);
    };

    // $("#textbox").focus();

    // $(window).focus(function(e) {
    //     $("#textbox").focus();
    // });

    var countDownDate = new Date("Feb 9, 2022 00:00:00").getTime();
    var x = setInterval(function() {
        var now = new Date().getTime();
        var distance = countDownDate - now;
        var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        var seconds = Math.floor((distance % (1000 * 60)) / 1000);
        document.getElementById("timer").innerHTML = hours + "h " + minutes + "m " + seconds + "s ";
        if (distance < 0) {
            clearInterval(x);
            document.getElementById("timer").innerHTML = "Starting soon";
        }
    }, 1000);


    
    ////////////////////////////

    function resetBoard() {
        $("#textbox").val("");
        $(".letter").removeClass("letter_clicked");
    }

    function submit() {
        //correct
        input = $("#textbox").val().toUpperCase()
        if (answer.includes(input)){
            if (guesses.includes(input)){
            }
            else{
                word_id = "word" + answer.indexOf(input)
                children = document.getElementById(word_id).getElementsByTagName('*');
                for (i in input){
                    children[parseInt(i)+1].innerHTML = input[i];
                }
                guesses.push(input)
                $("#score").html(guesses.length)
                $(".letter_clicked").addClass("letter_correct");
                setCookie('guesses', guesses, 9999)
                console.log(getCookie('guesses'))
                setTimeout(function(){
                    $(".letter").removeClass("letter_correct");
                }, 400);
            }
        }
        //wrong
        else {
            $(".letter_clicked").addClass("letter_wrong");
            setTimeout(function(){
                $(".letter").removeClass("letter_wrong");
            }, 400);
        };
        resetBoard();
    };

    $( ".letter" ).click(function() {
        if(!$(this).hasClass("letter_clicked")){
            $( this ).addClass("letter_clicked");
            $("#textbox").val($("#textbox").val() + $(this).text());
        }
    });

    $( "#clear_btn" ).click(function() {
        resetBoard();
    });

    $( "#submit_btn" ).click(function () {
        submit();
    });

    // on backspace
    $('#textbox').keyup(function(e){
        if(e.keyCode == 8) {

        }
        if (event.keyCode === 13) {
            submit();
        }
        if(e.key === "Escape") {
            resetBoard();
        }
    })  

    $('#textbox').on('input', function() {
        input = $("#textbox").val().toUpperCase();
        var board = puzzle
        $(".letter").removeClass("letter_clicked");
        for (i in input) {
            if (board.includes(input[i])){
                var x = board.indexOf(input[i]);
                console.log(i)   
                var id = "#l" + x.toString();
                board = board.replace(input[i], "0");
                console.log(board)
                $( id ).addClass("letter_clicked");
            }
            else {
                //wrong
            }
        }
    });

    $( "#score" ).click(function() {
        
    });




</script>
</html>